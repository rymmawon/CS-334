<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sign In</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="css/style.css">
</head>

<body class="d-flex flex-column min-vh-100">
  <header class="bg-light py-3">
    <div class="container">
      <nav class="navbar navbar-expand-lg navbar-light">
        <a class="navbar-brand" href="index.html"><img src="images/logo.png" alt="Logo"
            style="width: 65px; height: auto;"></a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto gap-3">
            <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
            <li class="nav-item"><a class="nav-link" href="shop.html">Shop</a></li>
            <li class="nav-item"><a class="nav-link" href="cart.html">Cart</a></li>
            <li class="nav-item"><a class="nav-link" href="contact.html">Contact Us</a></li>
            <li class="nav-item"><a class="nav-link active" href="register.html">Sign Up</a></li>
          </ul>
        </div>
      </nav>
    </div>
  </header>
  <main class="flex-shrink-0 flex-grow-1 shadow contact">
    <div class="content">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-md-6 contents">
            <div class="row justify-content-center">
              <div class="col-md-12">
                <div class="form-block">
                  <div class="mb-4">
                    <h2>Sign In</h2>
                  </div>
                  <form action="#" method="post">
                    <div class="form-group first">
                      <label for="email">Email</label>
                      <input type="text" class="form-control" id="email">

                    </div>
                    <div class="form-group">
                      <label for="password">Password</label>
                      <input type="password" class="form-control" id="password">

                      <input type="submit" value="Sign In" class="btn btn-primary">

                  </form>
                </div>
              </div>
            </div>

          </div>

        </div>
      </div>
    </div>
  </main>
  <footer class="bg-dark text-light text-center py-3 mt-auto w-100">
    <div class="container">
      <p>2025 ENMU CS-344 Team: Rymma Won, Vince Gnoodle, Zoe Martinez, Adan Delgado</p>
    </div>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let db;
    const request = indexedDB.open("TeaShopDB", 2);
    request.onupgradeneeded = function (event) {
      db = event.target.result;
      // Create the "users" object store if it doesn't exist.
      if (!db.objectStoreNames.contains("users")) {
        let userStore = db.createObjectStore("users", { keyPath: "email" });
        // Seed the store with a default user credential.
        userStore.add({ email: "user@teashop.com", password: "userpass" });
      }
    };

    request.onsuccess = function (event) {
      db = event.target.result;
      console.log("IndexedDB (users) initialized successfully.");
    };

    request.onerror = function (event) {
      console.error("IndexedDB error:", event.target.errorCode);
    };

    // Attach event listener to handle form submission
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelector('form').addEventListener('submit', function (event) {
        event.preventDefault();  // Prevent the default form submission

        // Retrieve input values from the form
        const emailInput = document.getElementById('email').value.trim();
        const passwordInput = document.getElementById('password').value;

        // Basic client-side validation: both fields must be filled
        if (!emailInput || !passwordInput) {
          alert('Please fill in both email and password.');
          return;
        }

        // Start a read-only transaction on the "users" object store
        const transaction = db.transaction(["users"], "readonly");
        const store = transaction.objectStore("users");
        const getRequest = store.get(emailInput);

        getRequest.onsuccess = function (event) {
          const user = getRequest.result;
          if (user && user.password === passwordInput) {
            // Credentials are correct; set session storage flags
            sessionStorage.setItem("userLoggedIn", "true");
            sessionStorage.setItem("userEmail", emailInput);
            // Redirect the user to the user dashboard (adjust the URL if necessary)
            window.location.href = "contact.html";
          } else {
            alert("Invalid email or password. Please try again.");
          }
        };

        getRequest.onerror = function (event) {
          console.error("Error retrieving user:", event.target.errorCode);
          alert("Error during login. Please try again later.");
        };
      });
    });
  </script>
</body>

</html>