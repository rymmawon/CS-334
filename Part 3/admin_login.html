<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>Admin Sign In</title>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
      <link rel="stylesheet" type="text/css" href="css/style.css">
   </head>
   <body class="d-flex flex-column min-vh-100">
    <main class="flex-shrink-0 flex-grow-1">
      <div class="login-container">
          <div class="container">
            <div class="row justify-content-center">
              <div class="col-md-6 contents">
                <div class="row justify-content-center">
                  <div class="col-md-12">
                    <div class="form-block">
                      <div class="mb-4 text-center">
                        <h2>Manager Sign In</h2>
                      </div>
                      <form action="#" method="post">
                        <div class="form-group first mb-3">
                          <label for="email">Email</label>
                          <input type="text" class="form-control" id="email">
                        </div>
                        <div class="form-group mb-4">
                          <label for="password">Password</label>
                          <input type="password" class="form-control" id="password">
                        </div>
                        <div class="d-grid">
                          <input type="submit" value="Sign In" class="btn btn-primary">
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
    </main>
    <footer class="bg-dark text-light text-center py-3 mt-auto w-100">
       <div class="container">
          <p>2025 ENMU CS-344 Team: Rymma Won, Vince Gnoodle, Zoe Martinez, Adan Delgado</p>
       </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Open (or create) the IndexedDB database "TeaShopDB" with an object store named "managers"
      let db;
      const request = indexedDB.open("TeaShopDB", 1);
    
      request.onupgradeneeded = function(event) {
        db = event.target.result;
        // Create an object store with the keyPath set to "email"
        let managerStore = db.createObjectStore("managers", { keyPath: "email" });
        // Seed the store with the hard-coded manager credentials
        managerStore.add({ email: "manager@teashop.com", password: "secure123" });
      };
    
      request.onsuccess = function(event) {
        db = event.target.result;
        console.log("IndexedDB initialized successfully.");
      };
    
      request.onerror = function(event) {
        console.error("IndexedDB error:", event.target.errorCode);
      };
    
      // Use DOMContentLoaded to ensure the form exists before attaching event listeners.
      document.addEventListener('DOMContentLoaded', function() {
        document.querySelector('form').addEventListener('submit', function(event) {
          event.preventDefault();  // Prevent default form submission
    
          // Retrieve input values
          const emailInput = document.getElementById('email').value.trim();
          const passwordInput = document.getElementById('password').value;
    
          // Basic validation
          if (!emailInput || !passwordInput) {
            alert('Please fill in both email and password.');
            return;
          }
    
          // Open a read-only transaction and query the "managers" object store
          const transaction = db.transaction(["managers"], "readonly");
          const store = transaction.objectStore("managers");
          const getRequest = store.get(emailInput);
    
          getRequest.onsuccess = function(event) {
            const manager = getRequest.result;
            if (manager && manager.password === passwordInput) {
              // If credentials match, set sessionStorage and redirect to the dashboard
              sessionStorage.setItem("managerLoggedIn", "true");
              sessionStorage.setItem("managerEmail", emailInput);
              window.location.href = "admin_dashboard.html";
            } else {
              alert("Invalid email or password. Please try again.");
            }
          };
    
          getRequest.onerror = function(event) {
            console.error("Error retrieving manager:", event.target.errorCode);
            alert("Error during login. Please try again later.");
          };
        });
      });
    </script>
    
 </body>
</html>
